<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kraken AI Trader</title>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@400;500;600;700&family=IBM+Plex+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --bg-primary: #0c0d10;
            --bg-secondary: #13141a;
            --bg-tertiary: #1a1c24;
            --bg-elevated: #21232d;
            --border: #2a2d3a;
            --border-light: #353849;
            --text-primary: #e8e9ed;
            --text-secondary: #9ca3af;
            --text-muted: #6b7280;
            --green: #10b981;
            --green-bg: rgba(16, 185, 129, 0.12);
            --red: #ef4444;
            --red-bg: rgba(239, 68, 68, 0.12);
            --blue: #3b82f6;
            --blue-bg: rgba(59, 130, 246, 0.12);
            --yellow: #f59e0b;
            --font-sans: 'IBM Plex Sans', -apple-system, sans-serif;
            --font-mono: 'IBM Plex Mono', monospace;
        }
        html { font-size: 14px; -webkit-font-smoothing: antialiased; }
        body { font-family: var(--font-sans); background: var(--bg-primary); color: var(--text-primary); min-height: 100vh; }

        .app { display: flex; flex-direction: column; min-height: 100vh; }

        /* Top Bar */
        .topbar {
            height: 56px; background: var(--bg-secondary); border-bottom: 1px solid var(--border);
            display: flex; align-items: center; justify-content: space-between; padding: 0 24px;
            position: sticky; top: 0; z-index: 100;
        }
        .logo { display: flex; align-items: center; gap: 10px; font-weight: 700; font-size: 16px; }
        .logo-icon { width: 32px; height: 32px; background: linear-gradient(135deg, var(--blue), #8b5cf6); border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 18px; }
        .topbar-stats { display: flex; gap: 8px; }
        .topbar-stat { display: flex; align-items: center; gap: 6px; padding: 6px 12px; background: var(--bg-tertiary); border-radius: 6px; font-size: 13px; }
        .topbar-stat .label { color: var(--text-muted); }
        .topbar-stat .value { font-family: var(--font-mono); font-weight: 500; }
        .topbar-stat .value.positive { color: var(--green); }
        .topbar-stat .value.negative { color: var(--red); }
        .topbar-right { display: flex; align-items: center; gap: 12px; }
        .status { display: flex; align-items: center; gap: 8px; padding: 6px 14px; border-radius: 20px; font-size: 13px; font-weight: 500; }
        .status.online { background: var(--green-bg); color: var(--green); }
        .status.offline { background: var(--red-bg); color: var(--red); }
        .status-dot { width: 8px; height: 8px; border-radius: 50%; background: currentColor; }
        .status.online .status-dot { animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }

        /* Main Grid */
        .main { flex: 1; display: grid; grid-template-columns: 1fr 360px; grid-template-rows: auto 1fr; gap: 1px; background: var(--border); }
        @media (max-width: 1100px) { .main { grid-template-columns: 1fr; } }
        .panel { background: var(--bg-secondary); }
        .panel-header { height: 48px; padding: 0 20px; display: flex; align-items: center; justify-content: space-between; border-bottom: 1px solid var(--border); }
        .panel-title { font-size: 12px; font-weight: 600; color: var(--text-secondary); text-transform: uppercase; letter-spacing: 0.5px; }
        .panel-body { padding: 20px; }

        /* Metrics */
        .metrics-panel { grid-column: 1 / -1; }
        .metrics-grid { display: grid; grid-template-columns: repeat(6, 1fr); gap: 16px; }
        @media (max-width: 1200px) { .metrics-grid { grid-template-columns: repeat(3, 1fr); } }
        @media (max-width: 600px) { .metrics-grid { grid-template-columns: repeat(2, 1fr); } }
        .metric { background: var(--bg-tertiary); border: 1px solid var(--border); border-radius: 12px; padding: 20px; }
        .metric:hover { border-color: var(--border-light); }
        .metric .label { font-size: 11px; font-weight: 500; color: var(--text-muted); text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px; }
        .metric .value { font-size: 28px; font-weight: 700; font-family: var(--font-mono); }
        .metric .value.lg { font-size: 32px; }
        .metric .value.positive { color: var(--green); }
        .metric .value.negative { color: var(--red); }
        .metric .sub { font-size: 12px; color: var(--text-muted); margin-top: 6px; }

        /* Table */
        .table { width: 100%; border-collapse: collapse; font-size: 13px; }
        .table th { text-align: left; padding: 12px 16px; font-weight: 500; font-size: 11px; text-transform: uppercase; letter-spacing: 0.5px; color: var(--text-muted); background: var(--bg-tertiary); border-bottom: 1px solid var(--border); position: sticky; top: 0; }
        .table td { padding: 14px 16px; border-bottom: 1px solid var(--border); }
        .table tr:hover { background: var(--bg-tertiary); }
        .table tr:last-child td { border-bottom: none; }
        .pair-cell { display: flex; align-items: center; gap: 10px; }
        .pair-icon { width: 32px; height: 32px; border-radius: 50%; background: var(--bg-elevated); display: flex; align-items: center; justify-content: center; font-size: 11px; font-weight: 600; color: var(--text-secondary); }
        .pair-name { font-weight: 600; font-family: var(--font-mono); }
        .price { font-family: var(--font-mono); font-weight: 500; }
        .pnl { font-family: var(--font-mono); font-weight: 600; }
        .pnl.positive { color: var(--green); }
        .pnl.negative { color: var(--red); }
        .badge { display: inline-block; padding: 4px 10px; border-radius: 4px; font-size: 11px; font-weight: 600; text-transform: uppercase; }
        .badge.tp { background: var(--green-bg); color: var(--green); }
        .badge.sl { background: var(--red-bg); color: var(--red); }
        .badge.trailing { background: var(--blue-bg); color: var(--blue); }
        .badge.timeout { background: var(--bg-elevated); color: var(--text-secondary); }

        /* Stats Sidebar */
        .sidebar { grid-row: span 2; overflow-y: auto; }
        .stats-section { margin-bottom: 24px; }
        .stats-title { font-size: 11px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; color: var(--text-muted); margin-bottom: 12px; }
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
        .stat-box { background: var(--bg-tertiary); border: 1px solid var(--border); border-radius: 8px; padding: 14px; }
        .stat-box .label { font-size: 11px; color: var(--text-muted); margin-bottom: 4px; }
        .stat-box .value { font-size: 18px; font-weight: 600; font-family: var(--font-mono); }
        .stat-box .value.green { color: var(--green); }
        .stat-box .value.red { color: var(--red); }
        .progress { height: 6px; background: var(--bg-elevated); border-radius: 3px; overflow: hidden; margin-top: 8px; }
        .progress-bar { height: 100%; background: var(--green); border-radius: 3px; transition: width 0.3s; }
        .progress-bar.low { background: var(--red); }
        .progress-bar.med { background: var(--yellow); }

        /* Activity */
        .activity { display: flex; flex-direction: column; }
        .activity-item { display: flex; gap: 12px; padding: 12px 0; border-bottom: 1px solid var(--border); }
        .activity-item:last-child { border-bottom: none; }
        .activity-icon { width: 32px; height: 32px; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 14px; flex-shrink: 0; }
        .activity-icon.buy { background: var(--green-bg); }
        .activity-icon.sell { background: var(--red-bg); }
        .activity-icon.info { background: var(--blue-bg); }
        .activity-content { flex: 1; min-width: 0; }
        .activity-title { font-weight: 500; font-size: 13px; }
        .activity-desc { font-size: 12px; color: var(--text-secondary); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .activity-time { font-size: 11px; font-family: var(--font-mono); color: var(--text-muted); }

        /* Buttons */
        .btn { display: inline-flex; align-items: center; gap: 6px; padding: 8px 16px; border: none; border-radius: 6px; font-family: var(--font-sans); font-size: 13px; font-weight: 600; cursor: pointer; transition: all 0.15s; }
        .btn-primary { background: var(--green); color: #fff; }
        .btn-primary:hover { filter: brightness(1.1); }
        .btn-danger { background: var(--red); color: #fff; }
        .btn-danger:hover { filter: brightness(1.1); }
        .btn-ghost { background: transparent; color: var(--text-secondary); border: 1px solid var(--border); }
        .btn-ghost:hover { background: var(--bg-tertiary); }
        .btn-icon { width: 36px; height: 36px; padding: 0; justify-content: center; }

        /* Empty */
        .empty { display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 60px 20px; text-align: center; }
        .empty-icon { font-size: 48px; margin-bottom: 16px; opacity: 0.4; }
        .empty-title { font-size: 16px; font-weight: 600; margin-bottom: 4px; }
        .empty-desc { font-size: 13px; color: var(--text-muted); }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: var(--border); border-radius: 4px; }
    </style>
</head>
<body>
    <div class="app">
        <header class="topbar">
            <div class="logo"><div class="logo-icon">üêô</div><span>Kraken AI Trader</span></div>
            <div class="topbar-stats">
                <div class="topbar-stat"><span class="label">P&L</span><span class="value" id="hdr-pnl">$0.00</span></div>
                <div class="topbar-stat"><span class="label">Win Rate</span><span class="value" id="hdr-wr">0%</span></div>
                <div class="topbar-stat"><span class="label">Trades</span><span class="value" id="hdr-trades">0</span></div>
            </div>
            <div class="topbar-right">
                <button class="btn btn-primary" id="btn-start" onclick="startBot()">‚ñ∂ Start</button>
                <button class="btn btn-danger" id="btn-stop" onclick="stopBot()" style="display:none">‚ñ† Stop</button>
                <button class="btn btn-ghost btn-icon" onclick="refresh()" title="Refresh">‚Üª</button>
                <div class="status offline" id="status"><span class="status-dot"></span><span id="status-txt">Offline</span></div>
            </div>
        </header>

        <main class="main">
            <section class="panel metrics-panel">
                <div class="panel-body">
                    <div class="metrics-grid">
                        <div class="metric"><div class="label">Total P&L</div><div class="value lg" id="m-pnl">$0.00</div><div class="sub" id="m-pnl-sub">0 trades</div></div>
                        <div class="metric"><div class="label">Win Rate</div><div class="value" id="m-wr">0.0%</div><div class="sub" id="m-wl">0W / 0L</div></div>
                        <div class="metric"><div class="label">Best Trade</div><div class="value positive" id="m-best">$0.00</div><div class="sub">Highest profit</div></div>
                        <div class="metric"><div class="label">Worst Trade</div><div class="value negative" id="m-worst">$0.00</div><div class="sub">Largest loss</div></div>
                        <div class="metric"><div class="label">Position</div><div class="value" id="m-pos">‚Äî</div><div class="sub" id="m-pos-sub">No active trade</div></div>
                        <div class="metric"><div class="label">Pairs Scanned</div><div class="value" id="m-pairs">0</div><div class="sub">Scanning market</div></div>
                    </div>
                </div>
            </section>

            <section class="panel">
                <div class="panel-header"><h2 class="panel-title">Recent Trades</h2><span style="color:var(--text-muted);font-size:12px" id="trades-cnt">0 trades</span></div>
                <div class="panel-body" style="padding:0;overflow:auto;max-height:500px">
                    <table class="table"><thead><tr><th>Pair</th><th>Entry</th><th>Exit</th><th>P&L</th><th>Type</th><th>Time</th></tr></thead><tbody id="trades-body">
                        <tr><td colspan="6"><div class="empty"><div class="empty-icon">üìä</div><div class="empty-title">No trades yet</div><div class="empty-desc">Start the bot to begin</div></div></td></tr>
                    </tbody></table>
                </div>
            </section>

            <aside class="panel sidebar">
                <div class="panel-header"><h2 class="panel-title">Stats & Activity</h2></div>
                <div class="panel-body">
                    <div class="stats-section">
                        <div class="stats-title">Exit Types</div>
                        <div class="stats-grid">
                            <div class="stat-box"><div class="label">Take Profit</div><div class="value green" id="s-tp">0</div></div>
                            <div class="stat-box"><div class="label">Stop Loss</div><div class="value red" id="s-sl">0</div></div>
                            <div class="stat-box"><div class="label">Trailing</div><div class="value" id="s-trail">0</div></div>
                            <div class="stat-box"><div class="label">Timeout</div><div class="value" id="s-timeout">0</div></div>
                        </div>
                    </div>
                    <div class="stats-section">
                        <div class="stats-title">Win Rate</div>
                        <div class="stat-box">
                            <div style="display:flex;justify-content:space-between"><div class="value" id="s-wr">0%</div><span style="color:var(--text-muted);font-size:12px" id="s-wr-detail">0/0</span></div>
                            <div class="progress"><div class="progress-bar low" id="wr-bar" style="width:0%"></div></div>
                        </div>
                    </div>
                    <div class="stats-section">
                        <div class="stats-title">Config</div>
                        <div class="stats-grid">
                            <div class="stat-box"><div class="label">Position Size</div><div class="value" id="s-size">$100</div></div>
                            <div class="stat-box"><div class="label">Profit Factor</div><div class="value" id="s-pf">0.00</div></div>
                        </div>
                    </div>
                    <div class="stats-section">
                        <div class="stats-title">Activity</div>
                        <div class="activity" id="activity"><div class="activity-item"><div class="activity-icon info">üì°</div><div class="activity-content"><div class="activity-title">Waiting</div><div class="activity-desc">Start bot for activity</div></div></div></div>
                    </div>
                </div>
            </aside>
        </main>
    </div>
    <script>
        let activityLog=[], lastMsg='';
        const fmt = v => { const n=parseFloat(v)||0; return (n>=0?'$':'-$')+Math.abs(n).toFixed(2); };
        const fmtP = v => { const n=parseFloat(v)||0; if(n===0)return'‚Äî'; if(n<0.01)return n.toFixed(8); if(n<1)return n.toFixed(6); return n.toFixed(4); };
        const fmtT = d => d.toLocaleTimeString('en-US',{hour12:false});
        const getBadge = r => { if(!r)return'timeout'; r=r.toLowerCase(); if(r.includes('tp')||r.includes('profit'))return'tp'; if(r.includes('sl')||r.includes('stop'))return'sl'; if(r.includes('trail'))return'trailing'; return'timeout'; };

        function addAct(icon,type,title,desc){ activityLog.unshift({icon,type,title,desc,time:fmtT(new Date())}); if(activityLog.length>12)activityLog.pop(); renderAct(); }
        function renderAct(){ document.getElementById('activity').innerHTML=activityLog.length?activityLog.map(a=>'<div class="activity-item"><div class="activity-icon '+a.type+'">'+a.icon+'</div><div class="activity-content"><div class="activity-title">'+a.title+'</div><div class="activity-desc">'+a.desc+'</div></div><div class="activity-time">'+a.time+'</div></div>').join(''):'<div class="activity-item"><div class="activity-icon info">üì°</div><div class="activity-content"><div class="activity-title">Waiting</div><div class="activity-desc">Start bot for activity</div></div></div>'; }

        async function updateStatus(){
            try{
                const r=await fetch('/api/bot/status'), d=await r.json();
                const s=document.getElementById('status'), t=document.getElementById('status-txt'), btnS=document.getElementById('btn-start'), btnE=document.getElementById('btn-stop');
                if(d.running){ s.className='status online'; t.textContent='Running'; btnS.style.display='none'; btnE.style.display='inline-flex'; }
                else{ s.className='status offline'; t.textContent='Stopped'; btnS.style.display='inline-flex'; btnE.style.display='none'; }
                document.getElementById('m-pairs').textContent=d.pairs_scanned||0;
                const msg=d.message||'', pos=document.getElementById('m-pos'), psub=document.getElementById('m-pos-sub');
                if(msg.includes('Entered')){ pos.textContent=msg.replace('Entered ',''); pos.style.color='var(--green)'; psub.textContent='Active'; }
                else{ pos.textContent='‚Äî'; pos.style.color='var(--text-primary)'; psub.textContent=d.running?'Scanning':'Idle'; }
                if(msg!==lastMsg && msg){ lastMsg=msg; if(msg.includes('Entered'))addAct('üìà','buy','Entered',msg); else if(msg.includes('Exited'))addAct('üìâ','sell','Exited',msg); }
            }catch(e){ console.error(e); }
        }

        async function updateLearning(){
            try{
                const r=await fetch('/api/bot/learning'), d=await r.json();
                const pnl=parseFloat(d.total_pnl)||0, cls=pnl>=0?'positive':'negative';
                document.getElementById('m-pnl').textContent=fmt(pnl); document.getElementById('m-pnl').className='value lg '+cls;
                document.getElementById('m-pnl-sub').textContent=(d.total_trades||0)+' trades';
                document.getElementById('hdr-pnl').textContent=fmt(pnl); document.getElementById('hdr-pnl').className='value '+cls;
                const wr=parseFloat(d.win_rate)||0, w=d.winning_trades||0, l=d.losing_trades||0;
                document.getElementById('m-wr').textContent=wr.toFixed(1)+'%'; document.getElementById('m-wl').textContent=w+'W / '+l+'L';
                document.getElementById('hdr-wr').textContent=wr.toFixed(1)+'%'; document.getElementById('hdr-trades').textContent=d.total_trades||0;
                document.getElementById('s-wr').textContent=wr.toFixed(1)+'%'; document.getElementById('s-wr-detail').textContent=w+'/'+(w+l);
                const bar=document.getElementById('wr-bar'); bar.style.width=Math.min(wr,100)+'%'; bar.className='progress-bar '+(wr<30?'low':wr<50?'med':'');
                document.getElementById('m-best').textContent=fmt(d.best_trade||0); document.getElementById('m-worst').textContent=fmt(d.worst_trade||0);
                document.getElementById('s-tp').textContent=d.tp_exits||0; document.getElementById('s-sl').textContent=d.sl_exits||0;
                document.getElementById('s-trail').textContent=d.trailing_exits||0; document.getElementById('s-timeout').textContent=d.timeout_exits||0;
                document.getElementById('s-size').textContent='$'+(d.position_size||100); document.getElementById('s-pf').textContent=(d.profit_factor||0).toFixed(2);
                document.getElementById('trades-cnt').textContent=(d.total_trades||0)+' trades';
                renderTrades(d.recent_trades||[]);
            }catch(e){ console.error(e); }
        }

        function renderTrades(trades){
            const tbody=document.getElementById('trades-body');
            if(!trades.length){ tbody.innerHTML='<tr><td colspan="6"><div class="empty"><div class="empty-icon">üìä</div><div class="empty-title">No trades yet</div><div class="empty-desc">Start the bot</div></div></td></tr>'; return; }
            tbody.innerHTML=trades.slice(0,20).map(t=>{
                const pnl=parseFloat(t.pnl)||0, cls=pnl>=0?'positive':'negative', reason=t.reason||t.exit_reason||'timeout', badge=getBadge(reason);
                const ts=t.entry_time||t.timestamp||0;
                const timeStr=ts?new Date(ts).toLocaleString('en-US',{month:'2-digit',day:'2-digit',hour:'2-digit',minute:'2-digit',hour12:false}):'‚Äî';
                return '<tr><td><div class="pair-cell"><div class="pair-icon">'+(t.pair||'??').replace('USD','').slice(0,3)+'</div><span class="pair-name">'+(t.pair||'N/A')+'</span></div></td><td class="price">'+fmtP(t.entry||t.entry_price)+'</td><td class="price">'+fmtP(t.exit||t.exit_price)+'</td><td class="pnl '+cls+'">'+fmt(pnl)+'</td><td><span class="badge '+badge+'">'+reason+'</span></td><td style="font-family:var(--font-mono);color:var(--text-muted);font-size:12px">'+timeStr+'</td></tr>';
            }).join('');
        }

        async function startBot(){ try{ const r=await fetch('/api/bot/start',{method:'POST'}), d=await r.json(); if(d.success){ addAct('üöÄ','info','Started','Bot is now running'); updateStatus(); } }catch(e){} }
        async function stopBot(){ try{ const r=await fetch('/api/bot/stop',{method:'POST'}), d=await r.json(); if(d.success){ addAct('üõë','info','Stopped','Bot stopped'); updateStatus(); } }catch(e){} }
        function refresh(){ updateStatus(); updateLearning(); addAct('üîÑ','info','Refreshed','Data updated'); }

        document.addEventListener('DOMContentLoaded',()=>{ updateStatus(); updateLearning(); addAct('üëã','info','Ready','Dashboard loaded'); setInterval(updateStatus,1000); setInterval(updateLearning,2000); });
    </script>
</body>
</html>
